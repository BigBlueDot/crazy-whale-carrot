
const express = require('express');
const bodyParser = require('body-parser')
const fs = require('fs');

const app = express();
app.use(bodyParser.json())
const port = process.env.PORT || 5000;

const sampleMap = [[4,3,6,5,3,6,5,5,5,7,5,5,5,5,3,0,6,5,3,0,6,5,3,0,0,0,0,0,0,0],[6,9,10,6,9,10,0,6,3,12,3,6,3,6,13,5,9,0,10,0,10,0,10,0,0,0,0,0,0,0],[12,5,9,12,5,13,5,9,12,5,13,9,10,10,0,6,5,7,13,5,9,0,10,0,0,0,0,0,0,0],[0,6,5,5,5,5,5,5,5,5,5,5,9,10,0,10,0,12,5,3,0,0,10,0,0,0,0,0,0,0],[0,12,5,5,5,3,6,5,3,6,5,5,3,10,0,12,5,3,0,10,0,0,10,0,0,0,0,0,0,0],[0,0,0,0,0,12,9,0,12,9,0,0,12,9,0,0,0,10,0,10,0,0,10,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,5,9,0,0,10,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,9,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,5,5,5,13,5,5,5,3,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,5,5,3,0,0,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,12,5,5,9,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,5,5,5,5,5,5,5,13,5,5,5,5,5,5,3,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,6,3,6,3,6,5,3,0,6,3,6,3,6,5,9,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,10,12,9,12,9,0,12,5,9,12,9,12,9,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,12,5,5,3,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,5,5,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];

app.get('/api/hello', (req, res) => {
  res.send({ express: 'Hello From Express' });
});

app.get('/api/map', (req, res) => {
  map = new Array(30).fill(new Array(30).fill(0))
  res.send({
    coords: {
      x: 0,
      y: 0
    },
    map: sampleMap
  })
})

app.post('/api/map', (req, res) => {
  // TODO: Save map to file
  const map = req.body.map;
  const fileName = req.body.fileName;
  const savedData = {
    map
  }

  fs.writeFile('./map_files/' + fileName + '.json', JSON.stringify(savedData), 'utf8', (success) => {
    res.sendStatus(200);
  });
})

app.get('/api/stats', (req, res) => {
  res.send({
    gumption: 10,
    resilience: 10
  })
})

app.listen(port, () => console.log(`Listening on port ${port}`));
